<!DOCTYPE html>
<html lang="tr" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>PNP Kontrol Merkezi</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.min.js"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <!-- HEADER -->
    <header class="header">
        <div class="h-brand">
            <div class="h-logo">P</div>
            <div>
                <div class="h-title">PNP Kontrol Merkezi</div>
                <div class="h-sub">Pick & Place CNC v2.0</div>
            </div>
        </div>
        <div class="h-center">
            <button class="tab-btn active" data-tab="control" onclick="switchTab('control')">ğŸ® Kontrol</button>
            <button class="tab-btn" data-tab="calibration" onclick="switchTab('calibration')">ğŸ”§ Kalibrasyon</button>
            <button class="tab-btn" data-tab="settings" onclick="switchTab('settings')">âš™ï¸ Ayarlar</button>
            <button class="tab-btn" data-tab="bases" onclick="switchTab('bases')">ğŸ“ Konumlar</button>
            <button class="tab-btn" data-tab="scenarios" onclick="switchTab('scenarios')">ğŸ¬ Senaryolar</button>
            <button class="tab-btn" data-tab="verification" onclick="switchTab('verification')">ğŸ‘ï¸ DoÄŸrulama</button>
        </div>
        <div class="h-right">
            <div class="badge ok" id="motorBadge"><span class="dot"></span><span id="motorBadgeTxt">Motor</span></div>
            <div class="grbl-badge idle" id="grblBadge">IDLE</div>
            <span class="uptime" id="uptimeEl">â± 00:00:00</span>
            <button class="theme-btn" onclick="toggleTheme()" title="Tema">ğŸŒ“</button>
            <a href="/logout" class="logout-btn">Ã‡Ä±kÄ±ÅŸ</a>
        </div>
    </header>
    <!-- ALARM BAR -->
    <div class="alarm-bar" id="alarmBar">âš ï¸ ALARM â€” Makine kilitli!
        <button onclick="unlockGrbl()">ğŸ”“ Unlock ($X)</button><button onclick="softReset()">ğŸ”„ Reset</button>
    </div>
    <!-- TOAST CONTAINER -->
    <div class="toast-container" id="toastBox"></div>

    <!-- â•â•â•â•â•â• TAB: KONTROL â•â•â•â•â•â• -->
    <main class="tab-content active" id="tab-control">
        <div class="ctrl-layout">
            <!-- LEFT: CONSOLE -->
            <div class="ctrl-console-col">
                <!-- Quick Scenario Launcher -->
                <div class="card" style="width:100%; display:flex; flex-direction:column; margin-bottom:10px">
                    <div class="card-h"><span class="card-t">ğŸ¬ HÄ±zlÄ± Senaryo</span></div>
                    <div class="card-b" style="padding:6px; display:flex; flex-direction:column; gap:4px">
                        <div style="display:flex; gap:4px">
                            <select id="quickScenarioSel" class="cam-inp"
                                style="flex:1; height:26px; font-size:0.75rem">
                                <option value="">Senaryo seÃ§...</option>
                            </select>
                            <button id="quickScenarioRunBtn" class="btn btn-p ripple" onclick="quickRunScenario()"
                                style="padding:0 8px; font-size:0.75rem; height:26px; line-height:1; display:flex; align-items:center; justify-content:center; width:auto; flex:0 0 auto; font-weight:bold"
                                title="BaÅŸlat">â–¶</button>
                        </div>
                        <div style="display:flex; gap:4px; margin-top:2px;">
                            <select id="quickMasterScenarioSel" class="cam-inp"
                                style="flex:1; height:26px; font-size:0.75rem; border-color:var(--yellow); color:var(--yellow)">
                                <option value="">ğŸ‘‘ Master Senaryo seÃ§...</option>
                            </select>
                            <button id="quickMasterScenarioRunBtn" class="btn btn-p ripple"
                                onclick="quickRunMasterScenario()"
                                style="padding:0 8px; font-size:0.75rem; height:26px; line-height:1; display:flex; align-items:center; justify-content:center; width:auto; flex:0 0 auto; font-weight:bold; background-color:var(--yellow); color:#000;"
                                title="BaÅŸlat">â–¶</button>
                        </div>
                        <button id="quickScenarioStopBtn" class="btn btn-d ripple" onclick="stopScenario()"
                            style="padding:6px; display:none">â¹ Durdur</button>
                        <div id="scenarioStatusBox"
                            style="background:rgba(0,0,0,0.3); border-radius:4px; padding:6px; max-height:60px; overflow-y:auto; font-family:'JetBrains Mono'; font-size:0.7rem; display:none">
                        </div>
                    </div>
                </div>

                <!-- Quick Center Panel (Restored) -->
                <div class="card" style="width:100%; display:flex; flex-direction:column; margin-bottom:10px">
                    <div class="card-h"><span class="card-t">ğŸ¯ HÄ±zlÄ± Merkezle</span></div>
                    <div class="card-b" style="padding:6px; display:flex; gap:4px">
                        <input type="text" id="targetInput" list="ocrWordsList" class="cam-inp" placeholder="Kelime..."
                            style="flex:1; text-transform:uppercase; height:26px; font-size:0.75rem"
                            onkeydown="if(event.key==='Enter')startAutoCenter()">
                        <datalist id="ocrWordsList"></datalist>
                        <button class="btn btn-p ripple" onclick="startAutoCenter()"
                            style="padding:0 10px; font-size:0.75rem; height:26px; line-height:1; display:flex; align-items:center; justify-content:center; width:auto; flex:0 0 auto; font-weight:bold">GÄ°T</button>
                    </div>
                    <div class="card-b" style="padding:0 6px 6px 6px; display:flex; gap:4px; overflow-x:auto">
                        <button class="btn btn-sm ripple" style="padding:2px 6px; flex:1"
                            onclick="setInputAndCenter('TEST')">TEST</button>
                        <button class="btn btn-sm ripple" style="padding:2px 6px; flex:1"
                            onclick="setInputAndCenter('CRB')">CRB</button>
                        <button class="btn btn-sm ripple" style="padding:2px 6px; flex:1"
                            onclick="setInputAndCenter('SHN')">SHN</button>
                        <button class="btn btn-sm ripple" style="padding:2px 6px; flex:1"
                            onclick="setInputAndCenter('AYD')">AYD</button>
                        <button class="btn btn-sm ripple" style="padding:2px 6px; flex:1"
                            onclick="setInputAndCenter('MUS')">MUS</button>
                    </div>
                    <div id="acStatusBox"
                        style="background:rgba(0,0,0,0.3); border-radius:4px; padding:6px; margin:0 10px 10px 10px; max-height:60px; overflow-y:auto; font-family:'JetBrains Mono'; font-size:0.7rem; display:none">
                    </div>
                </div>

                <!-- Quick Go To Base Panel -->
                <div class="card" style="width:100%; display:flex; flex-direction:column; margin-bottom:10px">
                    <div class="card-h"><span class="card-t">ğŸ“ HÄ±zlÄ± Konuma Git</span></div>
                    <div class="card-b" style="padding:6px; display:flex; gap:4px">
                        <select id="quickBaseSelMain" class="cam-inp" style="flex:1; height:26px; font-size:0.75rem">
                            <option value="">Konum seÃ§...</option>
                        </select>
                        <button class="btn btn-p ripple" onclick="quickGotoBaseMain()"
                            style="padding:0 10px; font-size:0.75rem; height:26px; line-height:1; display:flex; align-items:center; justify-content:center; width:auto; flex:0 0 auto; font-weight:bold">GÄ°T</button>
                    </div>
                </div>

                <!-- Console -->
                <div class="card console-card"
                    style="width:100%; height:40%; display:flex; flex-direction:column; margin-bottom:10px">
                    <div class="card-h"><span class="card-t">ğŸ“‹ Konsol</span>
                        <button class="btn-sm" onclick="clearConsole()">Temizle</button>
                    </div>
                    <div class="card-b console-body" style="flex:1; min-height:0; overflow:hidden">
                        <div class="console-box" id="console" style="flex:1; overflow-y:auto; min-height:0">
                            <div class="cline info"><span class="ct">[--:--:--]</span> BaÄŸlanÄ±yor...</div>
                        </div>
                        <div class="gcode-row"><input class="gcode-in" id="gcodeIn" placeholder="G-code komutu..."
                                onkeydown="if(event.key==='Enter')sendGcode()"><button class="gcode-btn"
                                onclick="sendGcode()">â–¶</button></div>
                    </div>
                </div>

            </div>

            <!-- CENTER: CAMERA -->
            <div class="ctrl-left">
                <!-- Verification HUD (Ana ekranda sonuÃ§larÄ± hÄ±zlÄ±ca gÃ¶rmek iÃ§in) -->
                <div id="verificationResultsHUD"
                    style="display:flex; gap:8px; margin-bottom:10px; overflow-x:auto; padding-bottom:4px"></div>

                <div class="cam-wrap" id="camWrap">
                    <img id="camFeed" src="/video_feed" alt="Kamera">
                    <!-- Overlays -->
                    <!-- TOP LEFT: Stats -->
                    <div class="cam-stats" id="camStats" style="font-size:1.1rem; font-weight:600">
                        <div class="stat-item">CAM: <span id="fpsCam">--</span> FPS</div>
                        <div class="stat-item">OCR: <span id="fpsOcr">--</span> FPS</div>
                    </div>

                    <!-- TOP RIGHT: Live Status -->
                    <div class="cam-live-badge">LIVE</div>

                    <!-- BOTTOM RIGHT: Settings & Resolution -->
                    <div class="cam-bottom-right">
                        <button class="cam-set-btn ripple" onclick="toggleCamSettings()"
                            title="Ã‡Ã¶zÃ¼nÃ¼rlÃ¼k AyarlarÄ±">âš™ï¸</button>
                        <div class="cam-res-badge" id="camResBadge">--Ã—--</div>
                    </div>

                    <!-- PIP Zoom Slider -->
                    <div class="cam-controls"
                        style="position:absolute; bottom:10px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.6); padding:5px 15px; border-radius:20px; display:flex; gap:10px; align-items:center; z-index:100; pointer-events:auto">
                        <span style="color:#fff; font-size:0.8rem; font-weight:bold">PIP ZOOM</span>
                        <input type="range" id="zoomSlider" min="1.0" max="10.0" step="0.1" value="2.0"
                            style="width:100px; cursor:pointer" oninput="setZoom(this.value)">
                        <span id="zoomVal" style="color:#ffeb3b; font-size:0.8rem; min-width:30px">x2.0</span>
                    </div>

                    <!-- Settings Overlay -->
                    <div class="cam-settings" id="camSettings">
                        <div class="cam-set-h">Kamera & YayÄ±n AyarlarÄ±</div>

                        <!-- Presets -->
                        <div class="cam-presets">
                            <button class="btn-sm" onclick="setRes(640,480)">640x480</button>
                            <button class="btn-sm" onclick="setRes(800,600)">800x600</button>
                            <button class="btn-sm" onclick="setRes(1280,720)">720p</button>
                            <button class="btn-sm" onclick="setRes(800,1080)">800x1080</button>
                            <button class="btn-sm" onclick="setRes(1920,1080)">1080p</button>
                        </div>

                        <div class="sep" style="margin:8px 0"></div>

                        <!-- Capture Resolution -->
                        <div style="font-size:0.7rem; color:#aaa; margin-bottom:4px">YAKALAMA (OCR)</div>
                        <div class="cam-set-row">
                            <input type="number" class="cam-inp" id="camW" value="800" placeholder="W">
                            <span class="cam-x">Ã—</span>
                            <input type="number" class="cam-inp" id="camH" value="1080" placeholder="H">
                        </div>

                        <!-- Stream Resolution -->
                        <div style="font-size:0.7rem; color:#aaa; margin:8px 0 4px 0">YAYIN (EKRAN)</div>
                        <!-- Stream Presets -->
                        <div class="cam-presets" style="margin-bottom:6px">
                            <button class="btn-sm" onclick="setStreamRes(300, this)">DÃ¼ÅŸÃ¼k</button>
                            <button class="btn-sm" onclick="setStreamRes(500, this)">Orta</button>
                            <button class="btn-sm" onclick="setStreamRes(800, this)">YÃ¼ksek</button>
                        </div>
                        <div class="cam-set-row">
                            <input type="number" class="cam-inp" id="streamW" value="800" placeholder="GeniÅŸlik (px)">
                            <span style="font-size:0.7rem; color:#666; margin-left:4px">px</span>
                        </div>

                        <button class="btn btn-p ripple"
                            style="padding:6px 12px;font-size:0.75rem;width:100%;margin-top:12px"
                            onclick="applyCamRes()">Uygula & Yeniden BaÅŸlat</button>
                    </div>
                </div>
                <div id="camOverlayText" class="cam-overlay-text"></div>
            </div>
            <div class="ctrl-right">
                <!-- KOORDÄ°NATLAR -->
                <div class="card coord-card">
                    <div class="card-h"><span class="card-t">ğŸ“ Pozisyon</span>
                    </div>
                    <div class="coord-grid">
                        <div class="coord"><span class="cl">X</span><span class="cv" id="posX">0.00</span><span
                                class="cu">mm</span></div>
                        <div class="coord"><span class="cl">Y</span><span class="cv" id="posY">0.00</span><span
                                class="cu">mm</span></div>
                        <div class="coord"><span class="cl">Z</span><span class="cv" id="posZ">0.00</span><span
                                class="cu">mm</span></div>
                    </div>
                </div>
                <!-- AKSÄ°YONLAR -->
                <div class="card">
                    <div class="card-h"><span class="card-t">âš¡ Aksiyonlar</span></div>
                    <div class="card-b">
                        <div class="act-col">
                            <div class="ac-st" id="acSt">
                                <div class="spinner"></div><span id="acMsg"></span>
                            </div>
                            <div class="btn-row"><button class="btn btn-g ripple" onclick="pumpCtl(true)">ğŸ’¨ Pompa
                                    AÃ‡</button><button class="btn btn-d ripple" onclick="pumpCtl(false)">ğŸ›‘ Pompa
                                    KAPAT</button></div>
                            <div class="btn-row"><button class="btn btn-y ripple" onclick="unlockGrbl()">ğŸ”“
                                    Unlock</button><button class="btn btn-c ripple" onclick="softReset()">ğŸ”„
                                    Reset</button></div>
                            <button class="btn btn-w ripple" onclick="shutdownServer()">ğŸ”Œ SUNUCU KAPAT</button>
                        </div>
                    </div>
                </div>
                <!-- MOTOR -->
                <div class="card">
                    <div class="card-h"><span class="card-t">ğŸ® Motor KontrolÃ¼</span></div>
                    <div class="card-b" style="text-align:center">
                        <div class="motor-area">
                            <!-- XY Grid: 3x3 with diagonals -->
                            <div class="xy-grid">
                                <button class="mbtn ripple" onclick="moveMotor(-1,-1)" title="Sol YukarÄ±">â†–</button>
                                <button class="mbtn ripple" onclick="moveMotor(0,-1)" title="YukarÄ±">â–²</button>
                                <button class="mbtn ripple" onclick="moveMotor(1,-1)" title="SaÄŸ YukarÄ±">â†—</button>
                                <button class="mbtn ripple" onclick="moveMotor(-1,0)" title="Sol">â—€</button>
                                <button class="mbtn mhome ripple" onclick="homeMotor()">HOME</button>
                                <button class="mbtn ripple" onclick="moveMotor(1,0)" title="SaÄŸ">â–¶</button>
                                <button class="mbtn ripple" onclick="moveMotor(-1,1)" title="Sol AÅŸaÄŸÄ±">â†™</button>
                                <button class="mbtn ripple" onclick="moveMotor(0,1)" title="AÅŸaÄŸÄ±">â–¼</button>
                                <button class="mbtn ripple" onclick="moveMotor(1,1)" title="SaÄŸ AÅŸaÄŸÄ±">â†˜</button>
                            </div>
                            <!-- Z Axis -->
                            <div class="z-col">
                                <span class="z-label">Z</span>
                                <button class="mbtn zbtn ripple" onclick="moveZ(1)" title="Z YukarÄ±">â–²</button>
                                <button class="mbtn zbtn ripple" onclick="moveZ(-1)" title="Z AÅŸaÄŸÄ±">â–¼</button>
                            </div>
                        </div>
                        <div class="step-row"><span class="sl">AdÄ±m:</span>
                            <div class="step-btns">
                                <button class="sb" onclick="setStep(0.1)">0.1</button>
                                <button class="sb" onclick="setStep(0.5)">0.5</button>
                                <button class="sb" onclick="setStep(1)">1.0</button>
                                <button class="sb active" onclick="setStep(5)">5.0</button>
                                <button class="sb" onclick="setStep(10)">10</button>
                                <button class="sb" onclick="setStep(50)">50</button>
                            </div><span class="sl">mm</span>
                        </div>

                        <!-- Z Hareketi (Moved here) -->
                        <div style="margin:8px 10px; border-top:1px solid var(--border); padding-top:8px">
                            <div class="grp-label" style="font-size:0.75rem; color:#aaa; margin-bottom:4px">Z HAREKETÄ°
                            </div>
                            <div style="display:flex; gap:6px">
                                <input type="number" id="zTargetInput" class="cam-inp" placeholder="Z" style="flex:1"
                                    value="-163">
                                <button class="btn btn-sm ripple" onclick="moveToZ()"
                                    style="flex:1; background:var(--blue); color:#fff; padding:6px; font-weight:bold">
                                    Ä°NDÄ°R
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- KONSOL -->
                <!-- KONSOL REMOVED -->
            </div>
        </div>
    </main>

    <!-- â•â•â•â•â•â• TAB: KALÄ°BRASYON â•â•â•â•â•â• -->
    <main class="tab-content" id="tab-calibration">
        <div style="display:flex; gap:20px; padding:20px; align-items:flex-start; flex-wrap:wrap">

            <!-- SOL: KAMERA VE SONUÃ‡LAR -->
            <div style="flex:1; min-width:400px; display:flex; flex-direction:column; gap:20px">
                <div class="card">
                    <div class="card-h"><span class="card-t">ğŸ“· Kalibrasyon KamerasÄ±</span></div>
                    <div class="card-b" style="padding:0; position:relative">
                        <img src="/video_feed" id="mainCam" class="cam-stream" alt="CanlÄ± Kamera"
                            style="width:100%; display:block; border-radius:0 0 8px 8px">
                        <div class="cw-crosshair">
                            <div class="cw-ch cw-ch-h"></div>
                            <div class="cw-ch cw-ch-v"></div>
                            <div class="cw-ch-center">âœ¦</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-h"><span class="card-t">ğŸ¯ 2. Algoritma Sonucu (Otomatik)</span></div>
                    <div class="card-b"
                        style="display:flex; gap:10px; background:rgba(0,0,0,0.2); padding:15px; border-radius:8px">
                        <div
                            style="flex:1; text-align:center; padding:10px; background:#222; border-radius:6px; border:1px solid #444">
                            <div style="font-size:0.75rem; color:#aaa; margin-bottom:5px">EKSEN SWAP</div>
                            <div id="calSwap" style="font-size:1.2rem; font-weight:bold; color:var(--blue)">--</div>
                        </div>
                        <div
                            style="flex:1; text-align:center; padding:10px; background:#222; border-radius:6px; border:1px solid #444">
                            <div style="font-size:0.75rem; color:#aaa; margin-bottom:5px">EKRAN X TERS</div>
                            <div id="calNegX" style="font-size:1.2rem; font-weight:bold; color:var(--blue)">--</div>
                        </div>
                        <div
                            style="flex:1; text-align:center; padding:10px; background:#222; border-radius:6px; border:1px solid #444">
                            <div style="font-size:0.75rem; color:#aaa; margin-bottom:5px">EKRAN Y TERS</div>
                            <div id="calNegY" style="font-size:1.2rem; font-weight:bold; color:var(--blue)">--</div>
                        </div>
                    </div>
                    <div class="card-b" style="padding-top:0">
                        <div class="cw-summary" id="calMapText"
                            style="margin-top:10px; text-align:center; color:var(--green)">HenÃ¼z kalibre edilmedi.</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-h"><span class="card-t">ğŸ“ 3. Pixel/mm OranÄ±</span></div>
                    <div class="card-b">
                        <div style="display:flex; gap:15px">
                            <div style="flex:1">
                                <label style="font-size:0.8rem; color:#aaa">X Ã‡arpanÄ±</label>
                                <input type="number" step="0.001" class="cfg-in" id="calPxX_display" value="0.1"
                                    readonly
                                    style="font-size:1.5rem; height:45px; text-align:center; background:#111; color:var(--green)">
                            </div>
                            <div style="flex:1">
                                <label style="font-size:0.8rem; color:#aaa">Y Ã‡arpanÄ±</label>
                                <input type="number" step="0.001" class="cfg-in" id="calPxY_display" value="0.1"
                                    readonly
                                    style="font-size:1.5rem; height:45px; text-align:center; background:#111; color:var(--green)">
                            </div>
                        </div>
                        <button class="btn btn-p ripple"
                            style="width:100%; margin-top:15px; padding:10px; font-size:1rem; font-weight:bold"
                            onclick="saveCalibration()">ğŸ’¾ TÃ¼m Kalibrasyonu Kaydet</button>
                    </div>
                </div>
            </div>

            <!-- SAÄ: TESTLER VE MANUEL AYAR -->
            <div style="flex:1; min-width:400px; display:flex; flex-direction:column; gap:20px">
                <style>
                    .cal-step-title {
                        font-size: 1.1rem;
                        font-weight: bold;
                        border-bottom: 2px solid var(--orange);
                        padding-bottom: 8px;
                        margin-bottom: 15px;
                        color: var(--orange)
                    }

                    .cw-dir.ripple {
                        padding: 10px;
                        font-size: 1rem;
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        gap: 5px;
                        background: #222;
                        border: 1px solid #444;
                        border-radius: 6px;
                        cursor: pointer;
                        color: #fff
                    }

                    .cw-dir.ripple:hover {
                        background: #333;
                        border-color: var(--orange)
                    }

                    .cw-dir-icon {
                        font-size: 1.5rem
                    }
                </style>
                <div class="card">
                    <div class="card-h"><span class="card-t">ğŸ› ï¸ 1. Motor & YÃ¶n Testleri</span></div>
                    <div class="card-b">

                        <div class="cfg-r"
                            style="margin-bottom:15px; background:rgba(255,255,255,0.05); padding:10px; border-radius:6px">
                            <label style="font-weight:bold">Test AdÄ±mÄ± Boyutu (Motor)</label>
                            <div style="display:flex; gap:10px; align-items:center">
                                <input type="number" class="cfg-in" id="calStep" value="2" step="0.5" min="0.5" max="20"
                                    style="width:80px; text-align:center">
                                <select class="cfg-in" id="calStepUnit" style="width:120px">
                                    <option value="mm">Milimetre (mm)</option>
                                    <option value="px">Piksel (px)</option>
                                </select>
                            </div>
                        </div>

                        <div class="cal-step-title">AdÄ±m 1A: Motor X+ Testi</div>
                        <p class="card-desc">Ã–nce butona basÄ±p motorun X+ yÃ¶nÃ¼ndeki hareketini kameradan izleyin.
                            ArdÄ±ndan nesnenin ekrandaki <b>hareket yÃ¶nÃ¼nÃ¼</b> aÅŸaÄŸÄ±daki butonlardan seÃ§in.</p>
                        <button class="btn btn-p ripple" onclick="calTestMotor('x',1)"
                            style="margin-bottom:15px; width:100%; padding:10px; font-weight:bold; background:var(--blue)">â–¶
                            X+ YÃ¶nÃ¼ne Hareket Ettir</button>
                        <div id="calPickX" style="display:flex; gap:10px; margin-bottom:20px; height:80px">
                            <button class="cw-dir ripple" onclick="calSetMapping('x','up')"><span
                                    class="cw-dir-icon">â¬†</span>YukarÄ±</button>
                            <button class="cw-dir ripple" onclick="calSetMapping('x','down')"><span
                                    class="cw-dir-icon">â¬‡</span>AÅŸaÄŸÄ±</button>
                            <button class="cw-dir ripple" onclick="calSetMapping('x','left')"><span
                                    class="cw-dir-icon">â¬…</span>Sol</button>
                            <button class="cw-dir ripple" onclick="calSetMapping('x','right')"><span
                                    class="cw-dir-icon">â¡</span>SaÄŸ</button>
                        </div>

                        <div class="cal-step-title" style="border-bottom-color:var(--green); color:var(--green)">AdÄ±m
                            1B: Motor Y+ Testi</div>
                        <p class="card-desc">Motorun Y+ yÃ¶nÃ¼ndeki hareketini izleyin ve nesnenin ekranda hangi yÃ¶ne
                            kaydÄ±ÄŸÄ±nÄ± seÃ§in.</p>
                        <button class="btn btn-p ripple" onclick="calTestMotor('y',1)"
                            style="margin-bottom:15px; width:100%; padding:10px; font-weight:bold; background:var(--green)">â–¶
                            Y+ YÃ¶nÃ¼ne Hareket Ettir</button>
                        <div id="calPickY" style="display:flex; gap:10px; height:80px">
                            <button class="cw-dir ripple" onclick="calSetMapping('y','up')"><span
                                    class="cw-dir-icon">â¬†</span>YukarÄ±</button>
                            <button class="cw-dir ripple" onclick="calSetMapping('y','down')"><span
                                    class="cw-dir-icon">â¬‡</span>AÅŸaÄŸÄ±</button>
                            <button class="cw-dir ripple" onclick="calSetMapping('y','left')"><span
                                    class="cw-dir-icon">â¬…</span>Sol</button>
                            <button class="cw-dir ripple" onclick="calSetMapping('y','right')"><span
                                    class="cw-dir-icon">â¡</span>SaÄŸ</button>
                        </div>

                    </div>
                </div>

                <!-- Manuel Eksen AyarÄ± (GeliÅŸmiÅŸ) -->
                <div class="card">
                    <div class="card-h" style="cursor:pointer"
                        onclick="document.getElementById('manualOverride').style.display = document.getElementById('manualOverride').style.display === 'none' ? 'block' : 'none'">
                        <span class="card-t">âš™ï¸ Manuel Eksen AyarÄ± (Ä°leri DÃ¼zey)</span>
                        <span style="font-size:0.8rem; color:#888">GeniÅŸlet â–¼</span>
                    </div>
                    <div class="card-b" id="manualOverride" style="display:none">
                        <p class="card-desc">Otomatik algoritmaya gÃ¼venmiyorsanÄ±z yÃ¶nleri manuel ters Ã§evirebilirsiniz.
                        </p>
                        <div class="cfg-r"><label>Eksenleri DeÄŸiÅŸtir (Swap Xâ†”Y)</label><input type="checkbox"
                                class="cfg-cb" id="calSwapCb" checked></div>
                        <div class="cfg-r"><label>Ekran X Ters Ã‡evir</label><input type="checkbox" class="cfg-cb"
                                id="calNegXCb"></div>
                        <div class="cfg-r"><label>Ekran Y Ters Ã‡evir</label><input type="checkbox" class="cfg-cb"
                                id="calNegYCb" checked></div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- â•â•â•â•â•â• TAB: AYARLAR â•â•â•â•â•â• -->
    <main class="tab-content" id="tab-settings">
        <style>
            .stg-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                gap: 16px;
                padding: 20px
            }

            .stg-section {
                font-size: 0.75rem;
                color: #888;
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 1px;
                margin-bottom: 8px;
                padding-bottom: 4px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1)
            }

            .stg-row {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 6px 0;
                gap: 10px;
                font-size: 0.85rem
            }

            .stg-row label {
                color: #ccc;
                flex: 1;
                white-space: nowrap
            }

            .stg-row .stg-val {
                flex: 0 0 auto;
                min-width: 80px
            }

            .stg-row input[type=number],
            .stg-row input[type=text],
            .stg-row select {
                background: #111;
                border: 1px solid #333;
                color: #fff;
                border-radius: 4px;
                padding: 5px 8px;
                font-size: 0.82rem;
                font-family: inherit
            }

            .stg-row input[type=number] {
                width: 80px;
                text-align: center
            }

            .stg-row input[type=text] {
                width: 100%
            }

            .stg-row input[type=checkbox] {
                width: 18px;
                height: 18px;
                accent-color: var(--blue)
            }

            .stg-save-row {
                display: flex;
                justify-content: flex-end;
                padding-top: 10px;
                border-top: 1px solid rgba(255, 255, 255, 0.08);
                margin-top: 8px
            }
        </style>
        <div class="stg-grid">
            <!-- MOTOR & KALÄ°BRASYON -->
            <div class="card">
                <div class="card-h"><span class="card-t">ğŸ›ï¸ Motor & Kalibrasyon</span></div>
                <div class="card-b" style="padding:12px">
                    <div class="stg-section">Piksel â†’ mm</div>
                    <div class="stg-row"><label>X KatsayÄ±sÄ±</label><input type="number" step="0.001" id="cfgPxX"
                            value="0.1"></div>
                    <div class="stg-row"><label>Y KatsayÄ±sÄ±</label><input type="number" step="0.001" id="cfgPxY"
                            value="0.1"></div>
                    <div class="stg-section" style="margin-top:10px">Hedef Nokta (px)</div>
                    <div class="stg-row"><label>Hedef X</label><input type="number" id="cfgTX" value="200"></div>
                    <div class="stg-row"><label>Hedef Y</label><input type="number" id="cfgTY" value="150"></div>
                    <div class="stg-section" style="margin-top:10px">Motor</div>
                    <div class="stg-row"><label>Feed Rate (mm/dk)</label><input type="number" id="cfgFeed" value="1000">
                    </div>
                    <div class="stg-row"><label>Tolerans (px)</label><input type="number" id="cfgTol" value="5"></div>
                    <div class="stg-row"><label>Maks Ä°terasyon</label><input type="number" id="cfgMaxIter" value="10">
                    </div>
                    <div class="stg-section" style="margin-top:10px">YÃ¶n</div>
                    <div class="stg-row"><label>X Ekseni Ters</label><input type="checkbox" id="cfgIX"></div>
                    <div class="stg-row"><label>Y Ekseni Ters</label><input type="checkbox" id="cfgIY"></div>
                    <div class="stg-save-row">
                        <button class="btn btn-p ripple" style="padding:6px 20px; font-size:0.82rem"
                            onclick="saveConfig()">ğŸ’¾ Kaydet</button>
                    </div>
                </div>
            </div>

            <!-- OCR AYARLARI -->
            <div class="card">
                <div class="card-h"><span class="card-t">ğŸ” OCR AyarlarÄ±</span></div>
                <div class="card-b" style="padding:12px">
                    <div class="stg-section">AlgÄ±lama</div>
                    <div class="stg-row"><label>GÃ¼ven EÅŸiÄŸi</label>
                        <div style="display:flex;align-items:center;gap:6px;flex:0 0 140px">
                            <input type="range" min="10" max="100" step="5" id="cfgOcrConf" value="40" style="flex:1"
                                oninput="$('cfgOcrConfVal').textContent=this.value">
                            <span class="mono" id="cfgOcrConfVal" style="min-width:24px;font-size:0.8rem">40</span>
                        </div>
                    </div>
                    <div class="stg-row"><label>PSM Modu</label>
                        <select id="cfgOcrPsm" style="width:140px">
                            <option value="6">SINGLE_BLOCK (6)</option>
                            <option value="11">SPARSE_TEXT (11)</option>
                            <option value="3">AUTO (3)</option>
                        </select>
                    </div>
                    <div class="stg-section" style="margin-top:10px">Filtreler</div>
                    <div class="stg-row"><label>Whitelist</label><input type="text" id="cfgOcrWhitelist"
                            value="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
                            style="text-transform:uppercase;font-family:'JetBrains Mono';letter-spacing:1px;flex:0 0 180px">
                    </div>
                    <div class="stg-row"><label>Min. Kelime</label><input type="number" id="cfgMinWordLen" value="3"
                            min="1" max="20" style="width:60px"><span
                            style="font-size:0.7rem;color:#666;margin-left:4px">harf</span></div>
                    <div class="stg-row"><label>Kutu BÃ¼yÃ¼me</label><input type="number" id="cfgBoxGrowth" value="3.0"
                            min="1.5" max="20" step="0.5" style="width:60px"><span
                            style="font-size:0.7rem;color:#666;margin-left:4px">x</span></div>
                    <div class="stg-section" style="margin-top:10px">BaÅŸlangÄ±Ã§</div>
                    <div class="stg-row"><label>AÃ§Ä±lÄ±ÅŸta Otomatik Home</label><input type="checkbox" id="cfgAutoHome"
                            checked></div>
                    <div class="stg-save-row">
                        <button class="btn btn-p ripple" style="padding:6px 20px; font-size:0.82rem"
                            onclick="saveOcrConfig()">ğŸ’¾ Kaydet</button>
                    </div>
                </div>
            </div>

            <!-- OCR Ä°ZLEME -->
            <div class="card">
                <div class="card-h">
                    <span class="card-t">ğŸ“Š OCR Ä°zleme</span>
                    <button class="btn-sm" onclick="clearErrors()">Temizle</button>
                </div>
                <div class="card-b" style="padding:12px">
                    <div style="display:flex; gap:15px; margin-bottom:10px">
                        <div style="flex:1; text-align:center; background:#111; border-radius:6px; padding:8px">
                            <div style="font-size:0.7rem; color:#888">ALGILANAN</div>
                            <div class="mono" id="detCnt" style="font-size:1.3rem; font-weight:bold; color:var(--blue)">
                                0</div>
                        </div>
                        <div style="flex:1; text-align:center; background:#111; border-radius:6px; padding:8px">
                            <div style="font-size:0.7rem; color:#888">HEDEF</div>
                            <div id="tgtSt" class="mono tgt-search" style="font-size:0.9rem; font-weight:bold">AranÄ±yor
                            </div>
                        </div>
                    </div>
                    <div class="ocr-results" id="ocrList" style="max-height:80px; overflow-y:auto; margin-bottom:8px">
                        <div class="ocr-empty">YazÄ± algÄ±lanmadÄ±</div>
                    </div>
                    <div style="font-size:0.7rem; color:#666; font-weight:600; margin-bottom:4px">HATALAR</div>
                    <div class="error-list" id="errorList" style="max-height:80px; overflow-y:auto">
                        <div class="ocr-empty">Hata yok</div>
                    </div>
                </div>
            </div>

            <!-- SÄ°STEM BÄ°LGÄ°SÄ° -->
            <div class="card">
                <div class="card-h"><span class="card-t">â„¹ï¸ Sistem</span></div>
                <div class="card-b" style="padding:12px">
                    <div class="stg-row"><label>Motor Port</label><span class="mono" id="sysPort"
                            style="color:var(--blue)">--</span></div>
                    <div class="stg-row"><label>Motor Durum</label><span class="mono" id="sysMotor">--</span></div>
                    <div class="stg-row"><label>Kamera</label><span class="mono" id="sysCam">--</span></div>
                    <div class="stg-row"><label>GRBL State</label><span class="mono" id="sysGrbl">--</span></div>
                    <div class="stg-row"><label>Ã‡alÄ±ÅŸma SÃ¼resi</label><span class="mono" id="sysUptime">--</span></div>
                    <div class="sep" style="margin:8px 0"></div>
                    <div style="font-size:0.7rem; color:#666; font-weight:600; margin-bottom:4px">KISAYOLLAR</div>
                    <div style="display:flex; gap:6px; flex-wrap:wrap">
                        <span style="background:#222; padding:3px 8px; border-radius:4px; font-size:0.75rem">â¬†â¬‡â¬…â¡
                            Motor</span>
                        <span style="background:#222; padding:3px 8px; border-radius:4px; font-size:0.75rem">H
                            Home</span>
                        <span style="background:#222; padding:3px 8px; border-radius:4px; font-size:0.75rem">C
                            Center</span>
                        <span style="background:#222; padding:3px 8px; border-radius:4px; font-size:0.75rem">E
                            Kapat</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- â•â•â•â•â•â• TAB: KONUMLAR â•â•â•â•â•â• -->
    <main class="tab-content" id="tab-bases">
        <div class="settings-layout">
            <!-- Sol Kolon: Yeni Konum Ekle -->
            <div class="card">
                <div class="card-h"><span class="card-t">â• Yeni Konum Ekle</span></div>
                <div class="card-b">
                    <div class="cfg-grid">
                        <div class="cfg-r"><label>Konum AdÄ±</label><input type="text" class="cfg-in" id="baseName"
                                placeholder="Ã–rn: Home, Pick1..."></div>
                        <div class="cfg-r"><label>X (mm)</label><input type="number" class="cfg-in" id="baseX"
                                value="0"></div>
                        <div class="cfg-r"><label>Y (mm)</label><input type="number" class="cfg-in" id="baseY"
                                value="0"></div>
                        <div class="cfg-r"><label>Z (mm)</label><input type="number" class="cfg-in" id="baseZ"
                                value="0"></div>
                        <div class="sep"></div>
                        <div class="btn-row">
                            <button class="btn btn-c ripple" onclick="fetchCurrentPos()">ğŸ“ Mevcut Konumu Ã‡ek</button>
                            <button class="btn btn-p ripple" onclick="saveBase()">ğŸ’¾ Kaydet</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SaÄŸ Kolon: KayÄ±tlÄ± Konumlar Listesi -->
            <div class="card" style="grid-column: span 1">
                <div class="card-h"><span class="card-t">ğŸ“‹ KayÄ±tlÄ± Konumlar</span></div>
                <div class="card-b">
                    <div class="base-list" id="baseList">
                        <div class="ocr-empty">KayÄ±tlÄ± konum yok.</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- â•â•â•â•â•â• TAB: SENARYOLAR (UNIFIED) â•â•â•â•â•â• -->
    <main class="tab-content" id="tab-scenarios">
        <div style="display:flex; gap:20px; padding:20px; align-items:flex-start; flex-wrap:wrap">

            <!-- SOL: NORMAL SENARYOLAR -->
            <div style="flex:1; min-width:400px; display:flex; flex-direction:column; gap:20px">
                <style>
                    .scenario-section-h {
                        font-size: 1.2rem;
                        font-weight: bold;
                        border-bottom: 2px solid var(--blue);
                        padding-bottom: 8px;
                        margin-bottom: 10px;
                        color: var(--blue)
                    }

                    .scenario-section-h.master {
                        border-bottom-color: var(--yellow);
                        color: var(--yellow)
                    }
                </style>
                <div class="scenario-section-h">ğŸ¬ Standart Senaryolar</div>
                <div class="card">
                    <div class="card-h"><span class="card-t">OluÅŸtur / DÃ¼zenle</span>
                        <button class="btn btn-sm ripple"
                            style="background:var(--blue); color:#fff; display:flex; align-items:center; gap:4px"
                            onclick="pasteScenarioFromClipboard()">ğŸ“‹ Pano'dan YapÄ±ÅŸtÄ±r</button>
                    </div>
                    <div class="card-b">
                        <div class="cfg-r"><label>Senaryo AdÄ±</label><input type="text" class="cfg-in" id="scenarioName"
                                placeholder="Ã–rn: Pick & Place 1"></div>
                        <div class="sep" style="margin:10px 0"></div>
                        <!-- AdÄ±m Ekleme -->
                        <div style="font-size:0.8rem; color:#aaa; margin-bottom:6px; font-weight:600">YENÄ° ADIM EKLE
                        </div>
                        <div style="display:flex; gap:6px; flex-wrap:wrap; align-items:flex-end">
                            <div style="flex:1; min-width:120px">
                                <select class="cfg-in" id="stepType" onchange="onStepTypeChange()">
                                    <option value="goto_base">ğŸ“ Konuma Git</option>
                                    <option value="auto_center">ğŸ¯ Kelimeye Merkezle</option>
                                    <option value="verify">ğŸ‘ï¸ DoÄŸruluk KontrolÃ¼</option>
                                    <option value="pump_on">ğŸ’¨ Pompa AÃ‡</option>
                                    <option value="pump_off">ğŸ›‘ Pompa KAPAT</option>
                                    <option value="delay">â³ Bekle</option>
                                    <option value="move_z">â†•ï¸ Z Konumuna Git</option>
                                    <option value="home">ğŸ  Home</option>
                                </select>
                            </div>
                            <div id="stepParamBox" style="flex:1; min-width:120px">
                                <select class="cfg-in" id="stepBaseSelect"></select>
                            </div>
                            <button id="addStepBtn" class="btn btn-p ripple" onclick="addScenarioStep()"
                                style="padding:8px 16px; font-weight:bold">+ Ekle</button>
                        </div>
                        <div class="sep" style="margin:10px 0"></div>
                        <!-- AdÄ±m Listesi -->
                        <div style="font-size:0.8rem; color:#aaa; margin-bottom:6px; font-weight:600">ADIMLAR</div>
                        <div id="scenarioStepList"
                            style="max-height:250px; overflow-y:auto; border:1px solid rgba(255,255,255,0.1); border-radius:6px; padding:4px; min-height:50px">
                            <div class="ocr-empty">HenÃ¼z adÄ±m eklenmedi.</div>
                        </div>
                        <div class="sep" style="margin:10px 0"></div>
                        <div class="btn-row" style="gap:8px">
                            <button class="btn ripple" onclick="clearScenarioSteps()"
                                style="padding:8px 16px; background:#d32f2f; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:bold; font-size:0.85rem">ğŸ—‘
                                Temizle</button>
                            <button class="btn ripple" onclick="saveScenario()"
                                style="padding:8px 16px; background:var(--blue); color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:bold; font-size:0.85rem">ğŸ’¾
                                Kaydet</button>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-h"><span class="card-t">ğŸ“‹ KayÄ±tlÄ± Senaryolar</span></div>
                    <div class="card-b">
                        <div id="scenarioList" style="max-height:200px; overflow-y:auto">
                            <div class="ocr-empty">KayÄ±tlÄ± senaryo yok.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SAÄ: MASTER SENARYOLAR -->
            <div style="flex:1; min-width:400px; display:flex; flex-direction:column; gap:20px">
                <div class="scenario-section-h master">ğŸ‘‘ Master Senaryolar</div>
                <div class="card">
                    <div class="card-h"><span class="card-t">OluÅŸtur / DÃ¼zenle</span></div>
                    <div class="card-b">
                        <p class="card-desc">Birden fazla senaryoyu arka arkaya Ã§alÄ±ÅŸacak ÅŸekilde birleÅŸtirin.</p>
                        <div class="cfg-r"><label>Master Senaryo AdÄ±</label><input type="text" class="cfg-in"
                                id="masterScenarioName" placeholder="Ã–rn: Tam Ãœretim AkÄ±ÅŸÄ±"></div>
                        <div class="sep" style="margin:10px 0"></div>

                        <div style="font-size:0.8rem; color:#aaa; margin-bottom:6px; font-weight:600">SENARYO EKLE</div>
                        <div style="display:flex; gap:6px; flex-wrap:wrap; align-items:flex-end">
                            <div style="flex:2; min-width:120px">
                                <select class="cfg-in" id="masterStepSelect"></select>
                            </div>
                            <button class="btn ripple" onclick="addMasterScenarioStep()"
                                style="padding:8px 16px; font-weight:bold; background:var(--blue); color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:0.85rem">+
                                Ekle</button>
                        </div>

                        <div class="sep" style="margin:10px 0"></div>
                        <div style="font-size:0.8rem; color:#aaa; margin-bottom:6px; font-weight:600">Ã‡ALIÅTIRMA SIRASI
                        </div>
                        <div id="masterScenarioStepList"
                            style="max-height:250px; overflow-y:auto; border:1px solid rgba(255,255,255,0.1); border-radius:6px; padding:4px; min-height:50px">
                            <div class="ocr-empty">HenÃ¼z senaryo eklenmedi.</div>
                        </div>

                        <div class="sep" style="margin:10px 0"></div>
                        <div class="btn-row" style="gap:8px">
                            <button class="btn ripple" onclick="clearMasterScenarioSteps()"
                                style="padding:8px 16px; background:#d32f2f; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:bold; font-size:0.85rem">ğŸ—‘
                                Temizle</button>
                            <button class="btn ripple" onclick="saveMasterScenario()"
                                style="padding:8px 16px; background:var(--blue); color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:bold; font-size:0.85rem">ğŸ’¾
                                Kaydet</button>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-h"><span class="card-t">ğŸ“‹ KayÄ±tlÄ± Master Senaryolar</span></div>
                    <div class="card-b">
                        <div id="masterScenarioList" style="max-height:200px; overflow-y:auto">
                            <div class="ocr-empty">KayÄ±tlÄ± master senaryo yok.</div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- â•â•â•â•â•â• TAB: DOÄRULAMA (VERIFICATION) â•â•â•â•â•â• -->
    <main class="tab-content" id="tab-verification">
        <div
            style="display:flex; gap:14px; padding:14px; align-items:flex-start; height:calc(100vh - 75px); overflow:hidden">
            <!-- SOL: Ayarlar, Kutular, SonuÃ§lar -->
            <div
                style="width:310px; flex-shrink:0; display:flex; flex-direction:column; gap:10px; overflow-y:auto; max-height:100%">
                <div class="card" style="margin:0">
                    <div class="card-h"><span class="card-t">ğŸ‘ï¸ Ayarlar</span></div>
                    <div class="card-b" style="padding:10px; display:flex; flex-direction:column; gap:8px">
                        <div class="cfg-r"><label>Konum</label><select id="vBaseSelect" class="cfg-in"></select></div>
                        <div style="background:#111; border-radius:6px; padding:8px; border:1px solid #333">
                            <div style="font-size:0.7rem; color:#888; font-weight:700; margin-bottom:4px">THRESHOLD
                                (EÅÄ°K)</div>
                            <div style="display:flex; align-items:center; gap:8px">
                                <input type="range" id="vThreshold" min="0" max="255" value="127" style="flex:1"
                                    oninput="document.getElementById('vThVal').textContent=this.value">
                                <span id="vThVal" class="mono"
                                    style="font-size:1.1rem; font-weight:bold; color:var(--orange); min-width:28px">127</span>
                            </div>
                            <p style="font-size:0.55rem; color:#555; margin-top:2px">DÃ¼ÅŸÃ¼k=fazla siyah, YÃ¼ksek=az siyah
                            </p>
                        </div>
                        <div style="display:flex; gap:6px">
                            <button class="btn btn-p ripple" onclick="saveVerificationSettings()"
                                style="flex:1; font-weight:bold; height:32px; font-size:0.8rem">ğŸ’¾ Kaydet</button>
                            <button class="btn ripple" onclick="testVerification()"
                                style="flex:1; font-weight:bold; height:32px; font-size:0.8rem; background:var(--orange); color:#fff; border:none; border-radius:6px; cursor:pointer">â–¶
                                Test Et</button>
                        </div>
                    </div>
                </div>
                <div class="card" style="margin:0">
                    <div class="card-h">
                        <span class="card-t">ğŸ“¦ Kutular (ROI)</span>
                        <button class="btn-sm" style="background:var(--blue); color:#fff; padding:3px 8px"
                            onclick="addNewVerificationBox()">+ Yeni</button>
                    </div>
                    <div class="card-b" style="padding:8px">
                        <div id="vBoxEditorList" style="display:flex; flex-direction:column; gap:6px"></div>
                    </div>
                </div>
                <!-- SONUÃ‡LAR burada kaldÄ±rÄ±ldÄ±, saÄŸ kolona taÅŸÄ±ndÄ± -->
            </div>

            <!-- ORTA: Kamera + Kutu Ã‡izim -->
            <div
                style="flex:1; display:flex; flex-direction:column; gap:10px; min-width:0; max-height:100%; overflow-y:auto">
                <div class="card cam-card"
                    style="flex:1; display:flex; flex-direction:column; overflow:hidden; margin:0">
                    <div class="card-h" style="flex-shrink:0"><span class="card-t">ğŸ“¸ Kamera (KutularÄ±
                            SÃ¼rÃ¼kle/BoyutlandÄ±r)</span></div>
                    <div class="card-b"
                        style="position:relative; flex:1; display:flex; align-items:center; justify-content:center; background:#000; overflow:hidden; padding:0"
                        id="vCanvasContainer">
                        <img src="/video_feed_raw" id="vMainCam" alt="CanlÄ± Kamera"
                            style="max-width:100%; max-height:100%; object-fit:contain; display:block"
                            draggable="false">
                        <div id="vBoxOverlay" style="position:absolute; pointer-events:none">
                            <!-- JS ile konumlandÄ±rÄ±lacak -->
                        </div>
                    </div>
                </div>
                <!-- SONUÃ‡LAR PANELÄ° burada kaldÄ±rÄ±ldÄ±, saÄŸ kolona taÅŸÄ±ndÄ± -->
            </div>

            <!-- SAÄ: Threshold Ã–nizleme -->
            <div
                style="width:260px; flex-shrink:0; display:flex; flex-direction:column; gap:10px; max-height:100%; overflow-y:auto">
                <div class="card" id="vResultsPanel" style="margin:0; display:none; flex-shrink:0">
                    <div class="card-h"><span class="card-t">ğŸ“Š SonuÃ§lar</span></div>
                    <div class="card-b" id="vResultsContent" style="padding:8px"></div>
                </div>
                <div class="card" style="margin:0">
                    <div class="card-h"><span class="card-t">ğŸ–¼ Threshold Ã–nizleme</span></div>
                    <div class="card-b" style="padding:0; background:#000">
                        <img id="vThresholdPreview" src="" alt="Test yapÄ±ldÄ±ktan sonra gÃ¶rÃ¼necek"
                            style="width:100%; display:block; min-height:200px; background:#111; border-radius:0 0 8px 8px; object-fit:contain">
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="/static/app.js"></script>
</body>

</html>