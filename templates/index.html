<!DOCTYPE html>
<html lang="tr" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>PNP Kontrol Merkezi</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.min.js"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <!-- HEADER -->
    <header class="header">
        <div class="h-brand">
            <div class="h-logo">P</div>
            <div>
                <div class="h-title">PNP Kontrol Merkezi</div>
                <div class="h-sub">Pick & Place CNC v2.0</div>
            </div>
        </div>
        <div class="h-center">
            <button class="tab-btn active" data-tab="control" onclick="switchTab('control')">ğŸ® Kontrol</button>
            <button class="tab-btn" data-tab="ocr" onclick="switchTab('ocr')">ğŸ” OCR</button>
            <button class="tab-btn" data-tab="calibration" onclick="switchTab('calibration')">ğŸ”§ Kalibrasyon</button>
            <button class="tab-btn" data-tab="settings" onclick="switchTab('settings')">âš™ï¸ Ayarlar</button>
            <button class="tab-btn" data-tab="bases" onclick="switchTab('bases')">ğŸ“ Konumlar</button>
            <button class="tab-btn" data-tab="scenarios" onclick="switchTab('scenarios')">ğŸ¬ Senaryolar</button>
        </div>
        <div class="h-right">
            <div class="badge ok" id="motorBadge"><span class="dot"></span><span id="motorBadgeTxt">Motor</span></div>
            <div class="grbl-badge idle" id="grblBadge">IDLE</div>
            <span class="uptime" id="uptimeEl">â± 00:00:00</span>
            <button class="theme-btn" onclick="toggleTheme()" title="Tema">ğŸŒ“</button>
            <a href="/logout" class="logout-btn">Ã‡Ä±kÄ±ÅŸ</a>
        </div>
    </header>
    <!-- ALARM BAR -->
    <div class="alarm-bar" id="alarmBar">âš ï¸ ALARM â€” Makine kilitli!
        <button onclick="unlockGrbl()">ğŸ”“ Unlock ($X)</button><button onclick="softReset()">ğŸ”„ Reset</button>
    </div>
    <!-- TOAST CONTAINER -->
    <div class="toast-container" id="toastBox"></div>

    <!-- â•â•â•â•â•â• TAB: KONTROL â•â•â•â•â•â• -->
    <main class="tab-content active" id="tab-control">
        <div class="ctrl-layout">
            <!-- LEFT: CONSOLE -->
            <div class="ctrl-console-col">
                <!-- Quick Scenario Launcher -->
                <div class="card" style="width:100%; display:flex; flex-direction:column; margin-bottom:10px">
                    <div class="card-h"><span class="card-t">ğŸ¬ HÄ±zlÄ± Senaryo</span></div>
                    <div class="card-b" style="padding:6px; display:flex; flex-direction:column; gap:4px">
                        <div style="display:flex; gap:4px">
                            <select id="quickScenarioSel" class="cam-inp"
                                style="flex:1; height:26px; font-size:0.75rem">
                                <option value="">Senaryo seÃ§...</option>
                            </select>
                            <button id="quickScenarioRunBtn" class="btn btn-p ripple" onclick="quickRunScenario()"
                                style="padding:0 8px; font-size:0.75rem; height:26px; line-height:1; display:flex; align-items:center; justify-content:center; width:auto; flex:0 0 auto; font-weight:bold"
                                title="BaÅŸlat">â–¶</button>
                        </div>
                        <button id="quickScenarioStopBtn" class="btn btn-d ripple" onclick="stopScenario()"
                            style="padding:6px; display:none">â¹ Durdur</button>
                        <div id="scenarioStatusBox"
                            style="background:rgba(0,0,0,0.3); border-radius:4px; padding:6px; max-height:60px; overflow-y:auto; font-family:'JetBrains Mono'; font-size:0.7rem; display:none">
                        </div>
                    </div>
                </div>

                <!-- Quick Center Panel (Restored) -->
                <div class="card" style="width:100%; display:flex; flex-direction:column; margin-bottom:10px">
                    <div class="card-h"><span class="card-t">ğŸ¯ HÄ±zlÄ± Merkezle</span></div>
                    <div class="card-b" style="padding:6px; display:flex; gap:4px">
                        <input type="text" id="targetInput" list="ocrWordsList" class="cam-inp" placeholder="Kelime..."
                            style="flex:1; text-transform:uppercase; height:26px; font-size:0.75rem"
                            onkeydown="if(event.key==='Enter')startAutoCenter()">
                        <datalist id="ocrWordsList"></datalist>
                        <button class="btn btn-p ripple" onclick="startAutoCenter()"
                            style="padding:0 10px; font-size:0.75rem; height:26px; line-height:1; display:flex; align-items:center; justify-content:center; width:auto; flex:0 0 auto; font-weight:bold">GÄ°T</button>
                    </div>
                    <div class="card-b" style="padding:0 6px 6px 6px; display:flex; gap:4px; overflow-x:auto">
                        <button class="btn btn-sm ripple" style="padding:2px 6px; flex:1"
                            onclick="setInputAndCenter('TEST')">TEST</button>
                        <button class="btn btn-sm ripple" style="padding:2px 6px; flex:1"
                            onclick="setInputAndCenter('CRB')">CRB</button>
                        <button class="btn btn-sm ripple" style="padding:2px 6px; flex:1"
                            onclick="setInputAndCenter('SHN')">SHN</button>
                        <button class="btn btn-sm ripple" style="padding:2px 6px; flex:1"
                            onclick="setInputAndCenter('AYD')">AYD</button>
                        <button class="btn btn-sm ripple" style="padding:2px 6px; flex:1"
                            onclick="setInputAndCenter('MUS')">MUS</button>
                    </div>
                    <div id="acStatusBox"
                        style="background:rgba(0,0,0,0.3); border-radius:4px; padding:6px; margin:0 10px 10px 10px; max-height:60px; overflow-y:auto; font-family:'JetBrains Mono'; font-size:0.7rem; display:none">
                    </div>
                </div>

                <!-- Console -->
                <div class="card console-card"
                    style="width:100%; height:40%; display:flex; flex-direction:column; margin-bottom:10px">
                    <div class="card-h"><span class="card-t">ğŸ“‹ Konsol</span>
                        <button class="btn-sm" onclick="clearConsole()">Temizle</button>
                    </div>
                    <div class="card-b console-body" style="flex:1; min-height:0; overflow:hidden">
                        <div class="console-box" id="console" style="flex:1; overflow-y:auto; min-height:0">
                            <div class="cline info"><span class="ct">[--:--:--]</span> BaÄŸlanÄ±yor...</div>
                        </div>
                        <div class="gcode-row"><input class="gcode-in" id="gcodeIn" placeholder="G-code komutu..."
                                onkeydown="if(event.key==='Enter')sendGcode()"><button class="gcode-btn"
                                onclick="sendGcode()">â–¶</button></div>
                    </div>
                </div>

            </div>

            <!-- CENTER: CAMERA -->
            <div class="ctrl-left">
                <div class="cam-wrap" id="camWrap">
                    <img id="camFeed" src="/video_feed" alt="Kamera">
                    <!-- Overlays -->
                    <!-- TOP LEFT: Stats -->
                    <div class="cam-stats" id="camStats" style="font-size:1.1rem; font-weight:600">
                        <div class="stat-item">CAM: <span id="fpsCam">--</span> FPS</div>
                        <div class="stat-item">OCR: <span id="fpsOcr">--</span> FPS</div>
                    </div>

                    <!-- TOP RIGHT: Live Status -->
                    <div class="cam-live-badge">LIVE</div>

                    <!-- BOTTOM RIGHT: Settings & Resolution -->
                    <div class="cam-bottom-right">
                        <button class="cam-set-btn ripple" onclick="toggleCamSettings()"
                            title="Ã‡Ã¶zÃ¼nÃ¼rlÃ¼k AyarlarÄ±">âš™ï¸</button>
                        <div class="cam-res-badge" id="camResBadge">--Ã—--</div>
                    </div>

                    <!-- PIP Zoom Slider -->
                    <div class="cam-controls"
                        style="position:absolute; bottom:10px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.6); padding:5px 15px; border-radius:20px; display:flex; gap:10px; align-items:center; z-index:100; pointer-events:auto">
                        <span style="color:#fff; font-size:0.8rem; font-weight:bold">PIP ZOOM</span>
                        <input type="range" id="zoomSlider" min="1.0" max="10.0" step="0.1" value="2.0"
                            style="width:100px; cursor:pointer" oninput="setZoom(this.value)">
                        <span id="zoomVal" style="color:#ffeb3b; font-size:0.8rem; min-width:30px">x2.0</span>
                    </div>

                    <!-- Settings Overlay -->
                    <div class="cam-settings" id="camSettings">
                        <div class="cam-set-h">Kamera & YayÄ±n AyarlarÄ±</div>

                        <!-- Presets -->
                        <div class="cam-presets">
                            <button class="btn-sm" onclick="setRes(640,480)">640x480</button>
                            <button class="btn-sm" onclick="setRes(800,600)">800x600</button>
                            <button class="btn-sm" onclick="setRes(1280,720)">720p</button>
                            <button class="btn-sm" onclick="setRes(800,1080)">800x1080</button>
                            <button class="btn-sm" onclick="setRes(1920,1080)">1080p</button>
                        </div>

                        <div class="sep" style="margin:8px 0"></div>

                        <!-- Capture Resolution -->
                        <div style="font-size:0.7rem; color:#aaa; margin-bottom:4px">YAKALAMA (OCR)</div>
                        <div class="cam-set-row">
                            <input type="number" class="cam-inp" id="camW" value="800" placeholder="W">
                            <span class="cam-x">Ã—</span>
                            <input type="number" class="cam-inp" id="camH" value="1080" placeholder="H">
                        </div>

                        <!-- Stream Resolution -->
                        <div style="font-size:0.7rem; color:#aaa; margin:8px 0 4px 0">YAYIN (EKRAN)</div>
                        <!-- Stream Presets -->
                        <div class="cam-presets" style="margin-bottom:6px">
                            <button class="btn-sm" onclick="setStreamRes(300, this)">DÃ¼ÅŸÃ¼k</button>
                            <button class="btn-sm" onclick="setStreamRes(500, this)">Orta</button>
                            <button class="btn-sm" onclick="setStreamRes(800, this)">YÃ¼ksek</button>
                        </div>
                        <div class="cam-set-row">
                            <input type="number" class="cam-inp" id="streamW" value="800" placeholder="GeniÅŸlik (px)">
                            <span style="font-size:0.7rem; color:#666; margin-left:4px">px</span>
                        </div>

                        <button class="btn btn-p ripple"
                            style="padding:6px 12px;font-size:0.75rem;width:100%;margin-top:12px"
                            onclick="applyCamRes()">Uygula & Yeniden BaÅŸlat</button>
                    </div>
                </div>
                <div id="camOverlayText" class="cam-overlay-text"></div>
            </div>
            <div class="ctrl-right">
                <!-- KOORDÄ°NATLAR -->
                <div class="card coord-card">
                    <div class="card-h"><span class="card-t">ğŸ“ Pozisyon</span>
                    </div>
                    <div class="coord-grid">
                        <div class="coord"><span class="cl">X</span><span class="cv" id="posX">0.00</span><span
                                class="cu">mm</span></div>
                        <div class="coord"><span class="cl">Y</span><span class="cv" id="posY">0.00</span><span
                                class="cu">mm</span></div>
                        <div class="coord"><span class="cl">Z</span><span class="cv" id="posZ">0.00</span><span
                                class="cu">mm</span></div>
                    </div>
                </div>
                <!-- AKSÄ°YONLAR -->
                <div class="card">
                    <div class="card-h"><span class="card-t">âš¡ Aksiyonlar</span></div>
                    <div class="card-b">
                        <div class="act-col">
                            <div class="ac-st" id="acSt">
                                <div class="spinner"></div><span id="acMsg"></span>
                            </div>
                            <div class="btn-row"><button class="btn btn-g ripple" onclick="pumpCtl(true)">ğŸ’¨ Pompa
                                    AÃ‡</button><button class="btn btn-d ripple" onclick="pumpCtl(false)">ğŸ›‘
                                    KAPAT</button></div>
                            <div class="btn-row"><button class="btn btn-y ripple" onclick="unlockGrbl()">ğŸ”“
                                    Unlock</button><button class="btn btn-c ripple" onclick="softReset()">ğŸ”„
                                    Reset</button></div>
                            <button class="btn btn-w ripple" onclick="shutdownServer()">ğŸ”Œ SUNUCU KAPAT</button>
                        </div>
                    </div>
                </div>
                <!-- MOTOR -->
                <div class="card">
                    <div class="card-h"><span class="card-t">ğŸ® Motor KontrolÃ¼</span></div>
                    <div class="card-b" style="text-align:center">
                        <div class="motor-area">
                            <!-- XY Grid: 3x3 with diagonals -->
                            <div class="xy-grid">
                                <button class="mbtn ripple" onclick="moveMotor(-1,-1)" title="Sol YukarÄ±">â†–</button>
                                <button class="mbtn ripple" onclick="moveMotor(0,-1)" title="YukarÄ±">â–²</button>
                                <button class="mbtn ripple" onclick="moveMotor(1,-1)" title="SaÄŸ YukarÄ±">â†—</button>
                                <button class="mbtn ripple" onclick="moveMotor(-1,0)" title="Sol">â—€</button>
                                <button class="mbtn mhome ripple" onclick="homeMotor()">HOME</button>
                                <button class="mbtn ripple" onclick="moveMotor(1,0)" title="SaÄŸ">â–¶</button>
                                <button class="mbtn ripple" onclick="moveMotor(-1,1)" title="Sol AÅŸaÄŸÄ±">â†™</button>
                                <button class="mbtn ripple" onclick="moveMotor(0,1)" title="AÅŸaÄŸÄ±">â–¼</button>
                                <button class="mbtn ripple" onclick="moveMotor(1,1)" title="SaÄŸ AÅŸaÄŸÄ±">â†˜</button>
                            </div>
                            <!-- Z Axis -->
                            <div class="z-col">
                                <span class="z-label">Z</span>
                                <button class="mbtn zbtn ripple" onclick="moveZ(1)" title="Z YukarÄ±">â–²</button>
                                <button class="mbtn zbtn ripple" onclick="moveZ(-1)" title="Z AÅŸaÄŸÄ±">â–¼</button>
                            </div>
                        </div>
                        <div class="step-row"><span class="sl">AdÄ±m:</span>
                            <div class="step-btns">
                                <button class="sb" onclick="setStep(0.1)">0.1</button>
                                <button class="sb" onclick="setStep(0.5)">0.5</button>
                                <button class="sb" onclick="setStep(1)">1.0</button>
                                <button class="sb active" onclick="setStep(5)">5.0</button>
                                <button class="sb" onclick="setStep(10)">10</button>
                                <button class="sb" onclick="setStep(50)">50</button>
                            </div><span class="sl">mm</span>
                        </div>

                        <!-- Z Hareketi (Moved here) -->
                        <div style="margin:8px 10px; border-top:1px solid var(--border); padding-top:8px">
                            <div class="grp-label" style="font-size:0.75rem; color:#aaa; margin-bottom:4px">Z HAREKETÄ°
                            </div>
                            <div style="display:flex; gap:6px">
                                <input type="number" id="zTargetInput" class="cam-inp" placeholder="Z" style="flex:1"
                                    value="-163">
                                <button class="btn btn-sm ripple" onclick="moveToZ()"
                                    style="flex:1; background:var(--blue); color:#fff; padding:6px; font-weight:bold">
                                    Ä°NDÄ°R
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- KONSOL -->
                <!-- KONSOL REMOVED -->
            </div>
        </div>
    </main>

    <!-- â•â•â•â•â•â• TAB: OCR â•â•â•â•â•â• -->
    <main class="tab-content" id="tab-ocr">
        <div class="ocr-layout">
            <div class="ocr-left">
                <div class="card">
                    <div class="card-h"><span class="card-t">ğŸ” OCR AlgÄ±lama</span><span class="badge-count"
                            id="ocrCnt2">0</span></div>
                    <div class="card-b">
                        <div class="info-row"><span style="font-size:1.1rem; font-weight:600">Kamera FPS</span><span
                                class="mono" id="camFps" style="font-size:1.1rem; font-weight:600">--</span></div>
                        <div class="info-row"><span style="font-size:1.1rem; font-weight:600">OCR FPS</span><span
                                class="mono" id="ocrFps" style="font-size:1.1rem; font-weight:600">--</span></div>
                        <div class="info-row"><span>AlgÄ±lanan</span><span class="mono" id="detCnt">0</span></div>
                        <div class="info-row"><span>Hedef Durum</span><span id="tgtSt"
                                class="mono tgt-search">AranÄ±yor</span></div>
                        <div class="sep"></div>
                        <div class="ocr-results" id="ocrList">
                            <div class="ocr-empty">YazÄ± algÄ±lanmadÄ±</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ocr-right">
                <!-- HEDEF KELÄ°MELER -->
                <div class="card">
                    <div class="card-h"><span class="card-t">ğŸ¯ Hedef Kelimeler</span></div>
                    <div class="card-b">
                        <p class="card-desc">OCR tarafÄ±ndan aranacak kelimeler. Bulunan kelime yeÅŸil olarak iÅŸaretlenir.
                        </p>
                        <!-- Dynamic Word List Container -->
                        <div id="wordList"></div>
                    </div>
                </div>
                <!-- HATA LOG -->
                <div class="card">
                    <div class="card-h"><span class="card-t">âš ï¸ Hata GeÃ§miÅŸi</span>
                        <button class="btn-sm" onclick="clearErrors()">Temizle</button>
                    </div>
                    <div class="card-b error-list" id="errorList">
                        <div class="ocr-empty">Hata yok</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- â•â•â•â•â•â• TAB: KALÄ°BRASYON â•â•â•â•â•â• -->
    <main class="tab-content" id="tab-calibration">
        <div class="cw-grid">
            <!-- SOL KOLON: Kamera -->
            <div class="cw-col">
                <div class="card">
                    <div class="card-h"><span class="card-t">ğŸ“· CanlÄ± Kamera</span><span class="badge-count">YÃ¶n
                            Testi</span></div>
                    <div class="card-b cw-cam-box">
                        <img class="cw-cam" src="/video_feed" alt="Kamera">
                        <div class="cw-crosshair">
                            <div class="cw-ch cw-ch-h"></div>
                            <div class="cw-ch cw-ch-v"></div>
                            <div class="cw-ch-center">âœ¦</div>
                        </div>
                    </div>
                </div>
                <!-- Mevcut Durum -->
                <div class="card">
                    <div class="card-h"><span class="card-t">ğŸ“‹ Kalibrasyon Durumu</span></div>
                    <div class="card-b">
                        <div class="info-row"><span>Eksen Swap</span><span class="mono" id="calSwap">--</span></div>
                        <div class="info-row"><span>Ekran X Ters</span><span class="mono" id="calNegX">--</span></div>
                        <div class="info-row"><span>Ekran Y Ters</span><span class="mono" id="calNegY">--</span></div>
                        <div class="sep"></div>
                        <div class="cw-summary" id="calMapText">HenÃ¼z kalibre edilmedi.</div>
                    </div>
                </div>
            </div>
            <!-- SAÄ KOLON: Wizard -->
            <div class="cw-col">
                <!-- AdÄ±m 1 -->
                <div class="card cw-step-card">
                    <div class="card-h"><span class="card-t"><span class="cw-num">1</span> Motor X+ Testi</span></div>
                    <div class="card-b">
                        <p class="card-desc">Butona basÄ±n, motor X+ yÃ¶nÃ¼ne hareket edecek. Kamerada nesne hangi yÃ¶ne
                            gitti?</p>
                        <button class="btn btn-p ripple" onclick="calTestMotor('x',1)" style="margin-bottom:10px">â–¶
                            Motor X+ Hareket Ettir</button>
                        <div class="cw-pick" id="calPickX">
                            <button class="cw-dir ripple" onclick="calSetMapping('x','up')"><span
                                    class="cw-dir-icon">â¬†</span>YukarÄ±</button>
                            <button class="cw-dir ripple" onclick="calSetMapping('x','right')"><span
                                    class="cw-dir-icon">â¡</span>SaÄŸ</button>
                            <button class="cw-dir ripple" onclick="calSetMapping('x','down')"><span
                                    class="cw-dir-icon">â¬‡</span>AÅŸaÄŸÄ±</button>
                            <button class="cw-dir ripple" onclick="calSetMapping('x','left')"><span
                                    class="cw-dir-icon">â¬…</span>Sol</button>
                        </div>
                    </div>
                </div>
                <!-- AdÄ±m 2 -->
                <div class="card cw-step-card">
                    <div class="card-h"><span class="card-t"><span class="cw-num">2</span> Motor Y+ Testi</span></div>
                    <div class="card-b">
                        <p class="card-desc">Butona basÄ±n, motor Y+ yÃ¶nÃ¼ne hareket edecek. Kamerada nesne hangi yÃ¶ne
                            gitti?</p>
                        <button class="btn btn-p ripple" onclick="calTestMotor('y',1)" style="margin-bottom:10px">â–¶
                            Motor Y+ Hareket Ettir</button>
                        <div class="cw-pick" id="calPickY">
                            <button class="cw-dir ripple" onclick="calSetMapping('y','up')"><span
                                    class="cw-dir-icon">â¬†</span>YukarÄ±</button>
                            <button class="cw-dir ripple" onclick="calSetMapping('y','right')"><span
                                    class="cw-dir-icon">â¡</span>SaÄŸ</button>
                            <button class="cw-dir ripple" onclick="calSetMapping('y','down')"><span
                                    class="cw-dir-icon">â¬‡</span>AÅŸaÄŸÄ±</button>
                            <button class="cw-dir ripple" onclick="calSetMapping('y','left')"><span
                                    class="cw-dir-icon">â¬…</span>Sol</button>
                        </div>
                    </div>
                </div>
                <!-- Manuel Ayar -->
                <div class="card">
                    <div class="card-h"><span class="card-t">âš™ï¸ Manuel Eksen AyarÄ±</span>
                        <button class="btn btn-p ripple" style="padding:5px 14px;font-size:12px;width:auto"
                            onclick="saveCalibration()">ğŸ’¾ Kaydet</button>
                    </div>
                    <div class="card-b">
                        <div class="cfg-r"><label>Eksenleri DeÄŸiÅŸtir (Swap Xâ†”Y)</label><input type="checkbox"
                                class="cfg-cb" id="calSwapCb" checked></div>
                        <div class="cfg-r"><label>Ekran X Ters Ã‡evir</label><input type="checkbox" class="cfg-cb"
                                id="calNegXCb"></div>
                        <div class="cfg-r"><label>Ekran Y Ters Ã‡evir</label><input type="checkbox" class="cfg-cb"
                                id="calNegYCb" checked></div>
                        <div class="sep"></div>
                        <div class="cfg-r"><label>Test AdÄ±mÄ± (mm)</label><input type="number" class="cfg-in"
                                id="calStep" value="2" step="0.5" min="0.5" max="20"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- â•â•â•â•â•â• TAB: AYARLAR â•â•â•â•â•â• -->
    <main class="tab-content" id="tab-settings">
        <div class="settings-layout">
            <div class="card">
                <div class="card-h"><span class="card-t">ğŸ“ Kalibrasyon</span>
                    <button class="btn btn-p ripple" style="padding:6px 16px;font-size:13px" onclick="saveConfig()">ğŸ’¾
                        Kaydet</button>
                </div>
                <div class="card-b">
                    <div class="cfg-grid">
                        <div class="cfg-group">
                            <h3>Piksel â†’ mm DÃ¶nÃ¼ÅŸÃ¼mÃ¼</h3>
                            <div class="cfg-r"><label>X KatsayÄ±sÄ±</label><input type="number" step="0.001"
                                    class="cfg-in" id="cfgPxX" value="0.1"></div>
                            <div class="cfg-r"><label>Y KatsayÄ±sÄ±</label><input type="number" step="0.001"
                                    class="cfg-in" id="cfgPxY" value="0.1"></div>
                        </div>
                        <div class="cfg-group">
                            <h3>Hedef Nokta (Piksel)</h3>
                            <div class="cfg-r"><label>Hedef X</label><input type="number" class="cfg-in" id="cfgTX"
                                    value="200"></div>
                            <div class="cfg-r"><label>Hedef Y</label><input type="number" class="cfg-in" id="cfgTY"
                                    value="150"></div>
                        </div>
                        <div class="cfg-group">
                            <h3>Motor AyarlarÄ±</h3>
                            <div class="cfg-r"><label>Feed Rate (mm/dk)</label><input type="number" class="cfg-in"
                                    id="cfgFeed" value="1000"></div>
                            <div class="cfg-r"><label>Tolerans (px)</label><input type="number" class="cfg-in"
                                    id="cfgTol" value="5"></div>
                            <div class="cfg-r"><label>Maks Ä°terasyon</label><input type="number" class="cfg-in"
                                    id="cfgMaxIter" value="10"></div>
                        </div>
                        <div class="cfg-group">
                            <h3>YÃ¶n AyarlarÄ±</h3>
                            <div class="cfg-r"><label>X Ekseni Ters</label><input type="checkbox" class="cfg-cb"
                                    id="cfgIX"></div>
                            <div class="cfg-r"><label>Y Ekseni Ters</label><input type="checkbox" class="cfg-cb"
                                    id="cfgIY"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- OCR AYARLARI -->
            <div class="card">
                <div class="card-h"><span class="card-t">ğŸ” OCR AyarlarÄ±</span>
                    <button class="btn btn-p ripple" style="padding:6px 16px;font-size:13px"
                        onclick="saveOcrConfig()">ğŸ’¾
                        Kaydet</button>
                </div>
                <div class="card-b">
                    <div class="cfg-grid">
                        <div class="cfg-group">
                            <h3>AlgÄ±lama Parametreleri</h3>
                            <div class="cfg-r"><label>OCR GÃ¼ven EÅŸiÄŸi</label>
                                <div style="display:flex;align-items:center;gap:8px">
                                    <input type="range" min="10" max="100" step="5" id="cfgOcrConf" value="40"
                                        style="flex:1" oninput="$('cfgOcrConfVal').textContent=this.value">
                                    <span class="mono" id="cfgOcrConfVal" style="min-width:30px">40</span>
                                </div>
                            </div>
                            <div class="cfg-r"><label>PSM Modu</label>
                                <select class="cfg-in" id="cfgOcrPsm">
                                    <option value="6">SINGLE_BLOCK (6) â€” Sabit YazÄ±</option>
                                    <option value="11">SPARSE_TEXT (11) â€” DaÄŸÄ±nÄ±k</option>
                                    <option value="3">AUTO (3) â€” Otomatik</option>
                                </select>
                            </div>
                        </div>
                        <div class="cfg-group">
                            <h3>Karakter Whitelist</h3>
                            <div class="cfg-r"><label>Ä°zin Verilen Karakterler</label>
                                <input type="text" class="cfg-in" id="cfgOcrWhitelist"
                                    value="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
                                    style="text-transform:uppercase; font-family:'JetBrains Mono'; letter-spacing:1px">
                            </div>
                            <p class="card-desc" style="font-size:0.7rem; color:#888; margin-top:4px">
                                BoÅŸ bÄ±rakÄ±lÄ±rsa tÃ¼m karakterler algÄ±lanÄ±r. Sadece bÃ¼yÃ¼k harf: ABCDEFGHIJKLMNOPQRSTUVWXYZ
                            </p>
                        </div>
                        <div class="cfg-group">
                            <h3>Ek Filtreler</h3>
                            <div class="cfg-r"><label>Min. Kelime UzunluÄŸu</label>
                                <div style="display:flex;align-items:center;gap:8px">
                                    <input type="number" class="cfg-in" id="cfgMinWordLen" value="3" min="1" max="20"
                                        step="1" style="width:80px">
                                    <span style="font-size:0.7rem;color:#888">harf</span>
                                </div>
                            </div>
                            <div class="cfg-r"><label>Kutu BÃ¼yÃ¼me Limiti</label>
                                <div style="display:flex;align-items:center;gap:8px">
                                    <input type="number" class="cfg-in" id="cfgBoxGrowth" value="3.0" min="1.5" max="20"
                                        step="0.5" style="width:80px">
                                    <span style="font-size:0.7rem;color:#888">x (ani sapÄ±tma korumasÄ±)</span>
                                </div>
                            </div>
                        </div>
                        <div class="cfg-group">
                            <h3>BaÅŸlangÄ±Ã§ AyarlarÄ±</h3>
                            <div class="cfg-r"><label>AÃ§Ä±lÄ±ÅŸta Otomatik Home</label><input type="checkbox"
                                    class="cfg-cb" id="cfgAutoHome" checked></div>
                            <p class="card-desc" style="font-size:0.7rem; color:#888; margin-top:4px">
                                Aktif olursa sunucu baÅŸladÄ±ÄŸÄ±nda cihaz otomatik home pozisyonuna gider.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-h"><span class="card-t">â„¹ï¸ Sistem Bilgisi</span></div>
                <div class="card-b">
                    <div class="info-row"><span>Motor Port</span><span class="mono" id="sysPort">--</span></div>
                    <div class="info-row"><span>Motor Durum</span><span class="mono" id="sysMotor">--</span></div>
                    <div class="info-row"><span>Kamera</span><span class="mono" id="sysCam">--</span></div>
                    <div class="info-row"><span>GRBL State</span><span class="mono" id="sysGrbl">--</span></div>
                    <div class="info-row"><span>Ã‡alÄ±ÅŸma SÃ¼resi</span><span class="mono" id="sysUptime">--</span></div>
                    <div class="sep"></div>
                    <div class="info-row"><span>Klavye KÄ±sayollarÄ±</span><span></span></div>
                    <div class="shortcut-list">
                        <div>â¬†â¬‡â¬…â¡ Motor Hareket</div>
                        <div>H â€” Home</div>
                        <div>C â€” Auto-Center</div>
                        <div>E â€” Sunucu Kapat</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- â•â•â•â•â•â• TAB: KONUMLAR â•â•â•â•â•â• -->
    <main class="tab-content" id="tab-bases">
        <div class="settings-layout">
            <!-- Sol Kolon: Yeni Konum Ekle -->
            <div class="card">
                <div class="card-h"><span class="card-t">â• Yeni Konum Ekle</span></div>
                <div class="card-b">
                    <div class="cfg-grid">
                        <div class="cfg-r"><label>Konum AdÄ±</label><input type="text" class="cfg-in" id="baseName"
                                placeholder="Ã–rn: Home, Pick1..."></div>
                        <div class="cfg-r"><label>X (mm)</label><input type="number" class="cfg-in" id="baseX"
                                value="0"></div>
                        <div class="cfg-r"><label>Y (mm)</label><input type="number" class="cfg-in" id="baseY"
                                value="0"></div>
                        <div class="cfg-r"><label>Z (mm)</label><input type="number" class="cfg-in" id="baseZ"
                                value="0"></div>
                        <div class="sep"></div>
                        <div class="btn-row">
                            <button class="btn btn-c ripple" onclick="fetchCurrentPos()">ğŸ“ Mevcut Konumu Ã‡ek</button>
                            <button class="btn btn-p ripple" onclick="saveBase()">ğŸ’¾ Kaydet</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SaÄŸ Kolon: KayÄ±tlÄ± Konumlar Listesi -->
            <div class="card" style="grid-column: span 1">
                <div class="card-h"><span class="card-t">ğŸ“‹ KayÄ±tlÄ± Konumlar</span></div>
                <div class="card-b">
                    <div class="base-list" id="baseList">
                        <div class="ocr-empty">KayÄ±tlÄ± konum yok.</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- â•â•â•â•â•â• TAB: SENARYOLAR â•â•â•â•â•â• -->
    <main class="tab-content" id="tab-scenarios">
        <div class="settings-layout">
            <!-- Sol: Senaryo OluÅŸtur/DÃ¼zenle -->
            <div class="card">
                <div class="card-h"><span class="card-t">ğŸ¬ Senaryo OluÅŸtur</span></div>
                <div class="card-b">
                    <div class="cfg-r"><label>Senaryo AdÄ±</label><input type="text" class="cfg-in" id="scenarioName"
                            placeholder="Ã–rn: Pick & Place 1"></div>
                    <div class="sep" style="margin:10px 0"></div>
                    <!-- AdÄ±m Ekleme -->
                    <div style="font-size:0.8rem; color:#aaa; margin-bottom:6px; font-weight:600">YENÄ° ADIM EKLE</div>
                    <div style="display:flex; gap:6px; flex-wrap:wrap; align-items:flex-end">
                        <div style="flex:1; min-width:120px">
                            <select class="cfg-in" id="stepType" onchange="onStepTypeChange()">
                                <option value="goto_base">ğŸ“ Konuma Git</option>
                                <option value="auto_center">ğŸ¯ Kelimeye Merkezle</option>
                                <option value="pump_on">ğŸ’¨ Pompa AÃ‡</option>
                                <option value="pump_off">ğŸ›‘ Pompa KAPAT</option>
                                <option value="delay">â³ Bekle</option>
                                <option value="move_z">â†•ï¸ Z Konumuna Git</option>
                                <option value="home">ğŸ  Home</option>
                            </select>
                        </div>
                        <div id="stepParamBox" style="flex:1; min-width:120px">
                            <select class="cfg-in" id="stepBaseSelect"></select>
                        </div>
                        <button id="addStepBtn" class="btn btn-p ripple" onclick="addScenarioStep()"
                            style="padding:8px 16px; font-weight:bold">+ Ekle</button>
                    </div>
                    <div class="sep" style="margin:10px 0"></div>
                    <!-- AdÄ±m Listesi -->
                    <div style="font-size:0.8rem; color:#aaa; margin-bottom:6px; font-weight:600">ADIMLAR</div>
                    <div id="scenarioStepList"
                        style="max-height:300px; overflow-y:auto; border:1px solid rgba(255,255,255,0.1); border-radius:6px; padding:4px; min-height:50px">
                        <div class="ocr-empty">HenÃ¼z adÄ±m eklenmedi.</div>
                    </div>
                    <div class="sep" style="margin:10px 0"></div>
                    <div class="btn-row">
                        <button class="btn btn-c ripple" onclick="clearScenarioSteps()">ğŸ—‘ Temizle</button>
                        <button class="btn btn-p ripple" onclick="saveScenario()">ğŸ’¾ Kaydet</button>
                    </div>
                </div>
            </div>

            <!-- SaÄŸ: KayÄ±tlÄ± Senaryolar -->
            <div class="card" style="grid-column: span 1">
                <div class="card-h"><span class="card-t">ğŸ“‹ KayÄ±tlÄ± Senaryolar</span></div>
                <div class="card-b">
                    <div id="scenarioList">
                        <div class="ocr-empty">KayÄ±tlÄ± senaryo yok.</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="/static/app.js"></script>
</body>

</html>